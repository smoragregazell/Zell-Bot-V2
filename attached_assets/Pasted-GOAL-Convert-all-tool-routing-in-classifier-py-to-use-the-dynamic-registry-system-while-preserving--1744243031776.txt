GOAL
Convert all tool routing in classifier.py to use the dynamic registry system, while preserving the toggle between search_combined (hybrid) and semantic_tool (vector-only).

ğŸ“¦ TOOL FILES TO MODIFY
In each tool file, you will:

Import the register_tool decorator

Decorate the main tool function using the EXACT classification string returned by the classifier prompt

ğŸ”§ 1. ticket_tool.py
python
Copy
Edit
from utils.tool_registry import register_tool

@register_tool("Consulta de Tickets")
def execute_ticket_query_tool(inputs, conversation_id, interaction_id=None):
ğŸ”§ 2. query_tool.py
python
Copy
Edit
from utils.tool_registry import register_tool

@register_tool("BÃºsqueda de Query")
def execute_ticket_query_tool(inputs, conversation_id, interaction_id=None):
ğŸ”§ 3. search_combined.py (this is the hybrid search tool)
python
Copy
Edit
from utils.tool_registry import register_tool

@register_tool("BÃºsqueda SemÃ¡ntica (Hybrid)")
def execute_combined_ticket_search(inputs, conversation_id, interaction_id=None):
ğŸ”§ 4. semantic_tool.py (this is the vector-only fallback)
python
Copy
Edit
from utils.tool_registry import register_tool

@register_tool("BÃºsqueda SemÃ¡ntica (Vector)")
def execute_semantic_search(inputs, conversation_id, interaction_id=None):
ğŸ”§ 5. iso_tool.py
python
Copy
Edit
from utils.tool_registry import register_tool

@register_tool("ISO")
def iso_tool(inputs, conversation_id, interaction_id=None):
ğŸ”§ 6. continuation_tool.py
python
Copy
Edit
from utils.tool_registry import register_tool

@register_tool("Pregunta Continuada")
def semantic_followup_tool(inputs, conversation_id, interaction_id=None):
ğŸ§  classifier.py MODIFICATIONS
ğŸ¥‡ 1. Add these imports:
python
Copy
Edit
from utils.tool_registry import get_tool_by_classification
from utils.tool_response import make_error_response
ğŸ¥ˆ 2. Add this semantic toggle near the top:
python
Copy
Edit
USE_HYBRID_SEARCH = os.getenv("USE_HYBRID_SEARCH", "true").lower() == "true"
ğŸ¥‰ 3. Replace this giant if classification == ... block:
ğŸ”¥ Instead of manually calling tools with import/if blocksâ€¦

Replace the tool execution logic with:

python
Copy
Edit
# ğŸ” Determine tool name
tool_key = classification

# ğŸ§  Handle semantic toggle
if classification == "BÃºsqueda SemÃ¡ntica":
    tool_key = "BÃºsqueda SemÃ¡ntica (Hybrid)" if USE_HYBRID_SEARCH else "BÃºsqueda SemÃ¡ntica (Vector)"

# ğŸ” Lookup the tool function
tool_fn = get_tool_by_classification(tool_key)

if not tool_fn:
    return make_error_response(f"No se encontrÃ³ herramienta para: {tool_key}")

# ğŸš€ Run the tool (await if coroutine)
if callable(tool_fn):
    if hasattr(tool_fn, "__call__") and tool_fn.__code__.co_flags & 0x80:  # async check
        tool_response = await tool_fn(inputs, conversation_id, interaction_id)
    else:
        tool_response = tool_fn(inputs, conversation_id, interaction_id)
else:
    return make_error_response("La herramienta encontrada no es ejecutable.")